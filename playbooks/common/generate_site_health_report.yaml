---
# playbooks/common/generate_site_health_report.yaml

- name: "Global Reporting | Generate Site Health Dashboard"
  hosts: localhost
  connection: local
  gather_facts: false
  vars:
    _reports_root: "{{ ncs_config.report_directory | default('/srv/samba/reports') }}"
    _platform_root: "{{ _reports_root }}/platform"
    _scripts_dir: "{{ playbook_dir | dirname }}/scripts"

    report_stamp: "{{ now(utc=true, fmt='%Y%m%d') }}"
    report_date: "{{ now(utc=true, fmt='%Y-%m-%d %H:%M:%S') }}"
    report_id: "{{ now(utc=true, fmt='%Y%m%dT%H%M%SZ') }}"

  tasks:
    - name: "Build and Render Site Dashboard"
      ansible.builtin.include_role:
        name: internal.core.reporting
        tasks_from: site_dashboard.yaml
      vars:
        ncs_reporting_reports_root: "{{ _reports_root }}"
        ncs_reporting_platform_root: "{{ _platform_root }}"
        ncs_reporting_scripts_dir: "{{ _scripts_dir }}"
        ncs_reporting_report_stamp: "{{ report_stamp }}"
        ncs_reporting_report_date: "{{ report_date }}"
        ncs_reporting_report_id: "{{ report_id }}"
