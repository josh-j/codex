---
- name: "Phase 1: Prepare Environment"
  ansible.builtin.import_playbook: ../common/init_environment.yaml
  tags: ['always']

- name: "Phase 2: Ubuntu STIG Remediation"
  hosts: "{{ ubuntu_target_hosts | default('ubuntu_servers') }}"
  gather_facts: false
  tags: ['ubuntu', 'remediate', 'stig', 'security']
  roles:
    - role: internal.linux.ubuntu_system_discover
    # Note: Assuming you create a stig_remediate role, or pass a flag to stig_audit!
    - role: internal.linux.ubuntu_stig_remediate
    - role: internal.linux.ubuntu_stig_audit # Capture post-remediation STIG state

- name: "Phase 3: Aggregate and Report"
  ansible.builtin.import_playbook: ../common/aggregate_results.yaml
  tags: ['always']
