---
# internal.vmware.stig : vm/discovery.yaml
#
# Decomposed discovery pipeline for Virtual Machines.
# Supports hybrid collection (API modules + legacy core script).

- name: "VM Discovery | Core Collector (Legacy/Hybrid)"
  ansible.builtin.include_tasks: collectors/core_script.yaml
  when: vmware_stig_collector_backend | default('legacy') in ['legacy', 'hybrid']

- name: "VM Discovery | Inventory & Identity"
  ansible.builtin.include_tasks: collectors/vm_inventory.yaml
  when: vmware_stig_collector_backend | default('legacy') in ['hybrid', 'external_first']

- name: "VM Discovery | Security & Encryption"
  ansible.builtin.include_tasks: collectors/vm_security.yaml
  when: vmware_stig_collector_backend | default('legacy') in ['hybrid', 'external_first']

- name: "VM Discovery | Advanced Configuration"
  ansible.builtin.include_tasks: collectors/vm_extra_config.yaml
  when: vmware_stig_collector_backend | default('legacy') in ['hybrid', 'external_first']

- name: "VM Discovery | Virtual Devices"
  ansible.builtin.include_tasks: collectors/vm_devices.yaml
  when: vmware_stig_collector_backend | default('legacy') in ['hybrid', 'external_first']

- name: "VM Discovery | Normalize & Sync"
  ansible.builtin.include_tasks: normalize.yaml
