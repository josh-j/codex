---
# internal.vmware.stig : vm/normalize.yaml
#
# Normalizes raw VM API facts into the canonical schema.

- name: Normalize VM facts
  tags: [discovery, normalization]
  ansible.builtin.set_fact:
    vsphere_ctx: >-
      {{
        vsphere_ctx | default({}) | combine({
          'stig_facts': (_vm_raw_payload | default([]) | internal.vmware.normalize_vm_stig_facts(
            inventory_map=_vm_inventory_facts | default({}),
            security_map=_vm_security_facts | default({}),
            extra_config_map=_vm_extra_config_facts | default({}),
            hardware_map=_vm_hardware_facts | default({})
          ))
        }, recursive=true)
      }}
  when: _vm_raw_payload is defined
