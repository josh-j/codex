---
# internal.vmware.stig : esxi/identity.yaml

- name: Get host identity
  tags: [discovery, identity]
  community.vmware.vmware_host_info:
    filters:
      - name == "{{ inventory_hostname }}"
  register: _host_info_raw
  delegate_to: localhost

- name: Parse host identity
  tags: [discovery, identity]
  ansible.builtin.set_fact:
    _esxi_identity_facts:
      name: "{{ _host_info_raw.hosts[0].name }}"
      version: "{{ _host_info_raw.hosts[0].version }}"
      build: "{{ _host_info_raw.hosts[0].build }}"
      uuid: "{{ _host_info_raw.hosts[0].uuid | default('unknown') }}"
  when: _host_info_raw.hosts | default([]) | length > 0
