---
# internal.vmware.discovery : assemble.yaml

- name: Assemble staged discovery sections
  ansible.builtin.set_fact:
    _disc:
      appliance: "{{ _disc_appliance | default({}) }}"
      alarms: "{{ _disc_alarms | default({}) }}"
      datacenters: "{{ _disc_datacenters | default({}) }}"
      clusters: "{{ _disc_clusters | default({}) }}"
      hosts: "{{ _disc_hosts | default({}) }}"
      datastores: "{{ _disc_datastores | default({}) }}"
      vms: "{{ _disc_vms | default({}) }}"
      snapshots: "{{ _disc_snapshots | default({}) }}"
  changed_when: false

- name: Assemble discovery context
  ansible.builtin.set_fact:
    vmware_ctx: >-
      {{
        vmware_ctx
        | internal.vmware.build_discovery_ctx(
          _disc | default({}),
          _vmware_controller_collected_at
        )
      }}
  changed_when: false
