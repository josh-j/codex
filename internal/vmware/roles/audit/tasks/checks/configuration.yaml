---
# internal.vmware.audit : tasks/checks/configuration.yaml

- name: Audit | Build cluster configuration alert sets
  ansible.builtin.set_fact:
    _cfg_alerts: >-
      {{
        (vmware_ctx.inventory.clusters.list | default([]))
        | internal.vmware.audit_cluster_configuration_alerts(
          vmware_cluster_cpu_warning_pct | default(90) | float,
          vmware_cluster_mem_warning_pct | default(90) | float
        )
      }}
  changed_when: false

- name: Audit | Append cluster alerts once
  ansible.builtin.set_fact:
    vmware_alerts: >-
      {{
        (vmware_alerts | default([]) | list)
        + (_cfg_alerts.cluster_alerts | default([]) | list)
        + (_cfg_alerts.rollup_alerts | default([]) | list)
      }}
  changed_when: false
