---
# Ensure per-host report directories exist from an aggregated hosts mapping.
# Required vars:
#   ncs_reporting_hosts_map
#   ncs_reporting_host_dir_root
#
# Optional vars:
#   ncs_reporting_skip_keys (default common state/meta keys)

- name: Ensure per-host report directories exist
  ansible.builtin.file:
    path: "{{ ncs_reporting_host_dir_root }}/{{ item.key }}"
    state: directory
    mode: "0755"
  loop: "{{ (ncs_reporting_hosts_map | default({})) | dict2items }}"
  when: item.key not in (ncs_reporting_skip_keys | default('' | internal.core.report_skip_keys))
