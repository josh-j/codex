---
# Maintain a "latest" per-host symlink for rendered reports.
# Required vars:
#   ncs_reporting_hosts_map
#   ncs_reporting_host_dir_root
#   ncs_reporting_latest_src_name
#   ncs_reporting_latest_dest_name
#
# Optional vars:
#   ncs_reporting_skip_keys (default common state/meta keys)

- name: Maintain latest per-host symlink
  ansible.builtin.file:
    src: "{{ ncs_reporting_latest_src_name }}"
    dest: "{{ ncs_reporting_host_dir_root }}/{{ item.key }}/{{ ncs_reporting_latest_dest_name }}"
    state: link
    force: true
  loop: "{{ (ncs_reporting_hosts_map | default({})) | dict2items }}"
  when: item.key not in (ncs_reporting_skip_keys | default(['Summary', 'Split', 'platform', 'history']))

