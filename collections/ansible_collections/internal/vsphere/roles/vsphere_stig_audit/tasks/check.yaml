---
# collections/ansible_collections/internal/stig/roles/vsphere/tasks/check.yaml

- name: "VSphere | Run Generalized Audit Engine"
  ansible.builtin.include_role:
    name: internal.stig.common
    tasks_from: audit_orchestrator
  vars:
    # Explicitly access the fact to avoid the 'vars' dictionary warning
    raw_discovery_data: "{{ vcenter.stig_facts | default([]) }}"
    audit_logic_template: "vm_logic.j2"
    stig_filter: "{{ stig_vm_filter | default('') }}"
    stig_exclusions: "{{ exclusion_list | default([]) }}"

- name: "VSphere | Map Results to Local Variables"
  ansible.builtin.set_fact:
    vsphere_stig_vm_full_audit: "{{ audit_full_list }}"
    vsphere_stig_vm_violations: "{{ audit_violations }}"
