
---
# roles/vsphere/tasks/datastores/export.yaml
# Export datastore inventory and capacity metrics to CSV

- name: Export datastore capacity report
  ansible.builtin.include_role:
    name: internal.core.reporting
    tasks_from: export_csv
  vars:
    ops_csv_report_name: "datastores_capacity"
    ops_csv_headers:
      [
        "vCenter", "Datastore", "Type", "Capacity (GB)", "Free (GB)",
        "Free (%)", "Used (%)", "Status", "Accessible", "Maintenance Mode",
      ]
    # Explicit keys mapping
    ops_csv_keys:
      [
        "vcenter", "name", "type", "capacity_gb", "free_gb",
        "free_pct", "used_pct", "status", "accessible", "maintenance_mode"
      ]
    ops_csv_data: "{{ vcenter.datastores.list }}"
    ops_csv_sort_by: "free_pct"
  when: vcenter.config.export_csv
