---
# Initialize vCenter namespace with safe defaults.
# This prevents jinja undefined errors if discovery is skipped.

- name: Init | Initialize vCenter safe defaults
  ansible.builtin.set_fact:
    vcenter: "{{ (vcenter | default({})) | internal.core.recursive_combine(_vcenter_defaults) }}"
  vars:
    _vcenter_defaults:
      connection:
        hostname: "{{ inventory_hostname }}"
        reachable: false
      appliance:
        info: {}
        health: {}
        config: {}
        backup: {}
      datacenters:
        list: []
        names: []
        metrics: { total: 0 }
      clusters:
        by_name: {}
      hosts:
        list: []
        by_name: {}
      resources:
        cpu: { usage_pct: 0, total_mhz: 0, used_mhz: 0 }
        memory: { usage_pct: 0, total_gb: 0, used_gb: 0 }
        storage: { usage_pct: 0, total_gb: 0, used_gb: 0 }
      datastores:
        list: []
        metrics: { total: 0, problem_count: 0 }
      vms:
        list: []
        backup_analysis: []
        metrics: { total: 0 }
      snapshots:
        aged: []
        metrics: { total: 0 }
      alarms:
        list: []
        metrics: { total: 0 }
      summary:
        alerts:
          total: 0
          critical_count: 0
          warning_count: 0
          info_count: 0
          by_category: {}
        checks_completed: []
      checks_failed: false
  tags: [always]
