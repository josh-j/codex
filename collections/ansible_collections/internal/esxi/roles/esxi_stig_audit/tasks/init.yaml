---
# Initialize ESXi Namespace structure with safe defaults.
# This ensures auditing and reporting don't crash if discovery is skipped.

- name: ESXi | Initialize STIG audit structure
  ansible.builtin.set_fact:
    esxi_facts: "{{ esxi_facts | default({}) | internal.core.recursive_combine(structure) }}"
    # Initialize variables expected by stig_finalize/check tasks
    esxi_stig_violations: "{{ esxi_stig_violations | default([]) }}"
    esxi_stig_full_audit: "{{ esxi_stig_full_audit | default([]) }}"
  vars:
    structure:
      host_name: "{{ inventory_hostname }}"
      version: "unknown"
      build: "unknown"
      model: "unknown"
      cpu_mhz: 0
      mem_mb: 0
      power_state: "unknown"
      maintenance_mode: false
      ssh_enabled: false
      ssh_running: false
      ssh_config: {}
      adv_config: {}
      network: { vmnics: [], vswitches: [], portgroups: [] }
