---
# collections/ansible_collections/internal/linux/roles/ubuntu_system_discover/tasks/main.yaml

- name: Check OS Family
  ansible.builtin.fail:
    msg: "This role is for Ubuntu only. Found: {{ ansible_facts['distribution'] }}"
  when: ansible_facts['distribution'] != 'Ubuntu'
  tags: [always]

- name: Discovery - System, Updates, & Security
  block:
    - name: Run discovery
      ansible.builtin.include_tasks: discover.yaml
      when: not (ubuntu_skip_discovery | bool)
  rescue:
    - name: Log discovery failure
      ansible.builtin.debug:
        msg: "Discovery failed on {{ inventory_hostname }}, facts will reflect defaults only."
