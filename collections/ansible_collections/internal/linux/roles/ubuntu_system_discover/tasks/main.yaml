---
# collections/ansible_collections/internal/linux/roles/ubuntu_system_discover/tasks/main.yaml

- name: Ensure distribution facts are gathered
  ansible.builtin.setup:
    gather_subset:
      - "distribution"
  when: ansible_distribution is not defined
  tags: [always]

- name: Check OS Family
  ansible.builtin.fail:
    msg: "This role is for Ubuntu only. Found: {{ ansible_facts['distribution'] | default('Unknown') }}"
  # Access the fact via the ansible_facts dictionary
  when: ansible_facts['distribution'] | default('') != 'Ubuntu'

- name: Discovery - System, Updates, & Security
  block:
    - name: Run discovery tasks
      ansible.builtin.include_tasks: discover.yaml
      when: falset (ubuntu_skip_discovery | default(false) | bool)
  rescue:
    - name: Log discovery failure
      ansible.builtin.debug:
        msg: "Discovery failed on {{ inventory_hostname }}. State will reflect defaults only."
