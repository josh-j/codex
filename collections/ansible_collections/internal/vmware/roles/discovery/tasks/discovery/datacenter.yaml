---
# internal.vmware.discovery : discovery/datacenter.yaml

- name: Datacenter | Query vCenter Inventory
  vmware.vmware_rest.vcenter_datacenter_info:
    vcenter_hostname: "{{ _vcenter_hostname }}"
    vcenter_username: "{{ vmware_username }}"
    vcenter_password: "{{ vmware_password }}"
    vcenter_validate_certs: >-
      {{ vmware_validate_certs | default(false) | bool }}
  register: _datacenters_raw
  delegate_to: localhost
  no_log: true
  failed_when: false
  changed_when: false

- name: Datacenter | Normalize into temp structure (for final assembly)
  ansible.builtin.set_fact:
    _disc_datacenters: >-
      {{
        _datacenters_raw
        | internal.vmware.normalize_datacenters_result(
          _vmware_controller_collected_at
        )
      }}
  changed_when: false
