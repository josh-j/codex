---
# internal.vmware.discovery : discovery/appliance_backup.yaml

- name: Get VCSA backup schedule
  vmware.vmware.vcsa_backup_schedule_info:
    hostname: "{{ _vcenter_hostname }}"
    username: "{{ vmware_username }}"
    password: "{{ vmware_password }}"
    validate_certs: "{{ vmware_validate_certs | default(false) | bool }}"
  register: _vcsa_backup_info
  delegate_to: localhost
  failed_when: false
  changed_when: false
  no_log: true

- name: Normalize appliance backup state
  ansible.builtin.set_fact:
    _disc_appliance_backup: >-
      {{
        _vcsa_backup_info
        | internal.vmware.normalize_appliance_backup_result(
          _vmware_controller_collected_at
        )
      }}
  changed_when: false
