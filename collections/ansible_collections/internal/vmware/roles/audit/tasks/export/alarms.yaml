---
# Export Active Alarms
- name: Export active alarms to CSV
  ansible.builtin.include_role:
    name: internal.core.reporting
    tasks_from: export_csv
  vars:
    _alarms: "{{ vmware_ctx.health.alarms | default({}) }}"
    ncs_csv_report_name: "vcenter_active_alarms"
    ncs_csv_headers: ["vCenter", "Entity", "Alarm Name", "Severity", "Status", "Time"]
    ncs_csv_keys: ["vcenter", "entity", "alarm_name", "severity", "status", "time"]
    ncs_csv_data: "{{ _alarms.list | default([]) }}"
    ncs_csv_sort_by: "severity"
  when: (_alarms.metrics.total | default(0) | int > 0)
