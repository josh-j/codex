---
# Export Global Resource Metrics
- name: Export global resource summary
  ansible.builtin.include_role:
    name: internal.core.reporting
    tasks_from: export_csv
  vars:
    _res: "{{ vmware_ctx.resources | default({}) }}"
    ncs_csv_report_name: "global_resources"
    ncs_csv_headers: ["vCenter", "Clusters", "Hosts", "CPU (%)", "Mem (%)"]
    ncs_csv_keys: ["vcenter", "clusters", "hosts", "cpu_usage_pct", "memory_usage_pct"]
    ncs_csv_data:
      - vcenter: "{{ inventory_hostname }}"
        clusters: "{{ _res.clusters.total | default(0) }}"
        hosts: "{{ _res.hosts.total | default(0) }}"
        cpu_usage_pct: "{{ _res.cpu.usage_pct | default(0) }}"
        memory_usage_pct: "{{ _res.memory.usage_pct | default(0) }}"
