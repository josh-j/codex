---
# Export vCenter summary metrics
- name: Export vcenter summary to CSV
  ansible.builtin.include_role:
    name: internal.core.reporting
    tasks_from: export_csv
  vars:
    _summary: "{{ vmware_ctx.summary | default({}) }}"
    ncs_csv_report_name: "vcenter_summary"
    ncs_csv_headers:
      [
        "vCenter", "Total Alerts", "Critical", "Warning", "Info",
        "Backup Issues", "Capacity Issues", "Config Issues",
        "Infra Issues", "Security Issues"
      ]
    ncs_csv_keys:
      [
        "vcenter", "total_alerts", "critical", "warning", "info",
        "backup_issues", "capacity_issues", "config_issues",
        "infra_issues", "security_issues"
      ]
    ncs_csv_data:
      - vcenter: "{{ inventory_hostname }}"
        total_alerts: "{{ _summary.alerts.total | default(0) }}"
        critical: "{{ _summary.alerts.critical_count | default(0) }}"
        warning: "{{ _summary.alerts.warning_count | default(0) }}"
        info: "{{ _summary.alerts.info_count | default(0) }}"
        backup_issues: "{{ (_summary.alerts.by_category | default({})).backup | default(0) }}"
        capacity_issues: "{{ (_summary.alerts.by_category | default({})).capacity | default(0) }}"
        config_issues: "{{ (_summary.alerts.by_category | default({})).configuration | default(0) }}"
        infra_issues: "{{ (_summary.alerts.by_category | default({})).infrastructure | default(0) }}"
        security_issues: "{{ (_summary.alerts.by_category | default({})).security | default(0) }}"
