---
# internal.vmware.stig : defaults/main.yaml
#
# Combined defaults for ESXi and VM STIG audit/remediation.
# Section 0: Pipeline behaviour & role config
# Section 1: ESXi STIG toggle flags
# Section 2: ESXi STIG remediation values
# Section 3: VM STIG toggle flags & values

# =============================================================================
# 0. PIPELINE BEHAVIOUR & ROLE CONFIG
# =============================================================================
vmware_stig_enable_hardening: false
vmware_stig_enable_audit: true
esxi_stig_target_hosts: []
vm_stig_target_vms: []

vmware_config_quiet_mode: false
vmware_config_debug_mode: false
vmware_config_export_cklb: true

# Target type: esxi | vm (used as fallback when stig_target_type is not set)
vmware_stig_target: "esxi"

# =============================================================================
# 1. ESXi STIG TOGGLE FLAGS
# =============================================================================
# Set any to false to skip that check/remediation.
# Tasks fall back to bare esxi_70_NNNNNN for backward compatibility.
esxi_70_000001_Manage: true # Lockdown Mode
esxi_70_000002_Manage: true # DCUI.Access List
esxi_70_000003_Manage: true # Lockdown Mode Exceptions
esxi_70_000004_Manage: true # Syslog
esxi_70_000005_Manage: true # Account Lock Failures
esxi_70_000006_Manage: true # Account Unlock Timeout
esxi_70_000007_Manage: true # Consent Banner Welcome
esxi_70_000030_Manage: true # Log Level
esxi_70_000031_Manage: true # Password Complexity
esxi_70_000032_Manage: true # Password Reuse
esxi_70_000034_Manage: true # Mob
esxi_70_000035_Manage: true # SSH Running
esxi_70_000036_Manage: true # Shell Running
esxi_70_000037_Manage: true # Active Directory
esxi_70_000039_Manage: true # AD Admin Group
esxi_70_000041_Manage: true # Shell Interactive Timeout
esxi_70_000042_Manage: true # Shell Timeout
esxi_70_000043_Manage: true # DCUI Timeout
esxi_70_000045_Manage: true # Persistent Logs
esxi_70_000046_Manage: true # NTP
esxi_70_000047_Manage: true # Acceptance Level
esxi_70_000053_Manage: true # SNMP must be configured properly on the ESXi host.
esxi_70_000054_Manage: true # iSCSI CHAP
esxi_70_000055_Manage: true # Memory Salting
esxi_70_000056_Manage: true # Firewall Rules - recommend setting to false as it broke vmotion
esxi_70_000058_Manage: true # BPDU
esxi_70_000059_Manage: true # Forged Transmits
esxi_70_000060_Manage: true # MAC Changes
esxi_70_000061_Manage: true # Prom Mode
esxi_70_000062_Manage: true # dvFilter
esxi_70_000074_Manage: true # TLS 1.2
esxi_70_000079_Manage: true # Suppress Shell Warning
esxi_70_000081_Manage: true # Suppress Hyperthreading Warning
esxi_70_000083_Manage: true # Disable SLPD Service
esxi_70_000086_Manage: true # Syslog Cert Verification
esxi_70_000087_Manage: true # The ESXi host must enable volatile key destruction.
esxi_70_000088_Manage: true # API Timeout
esxi_70_000089_Manage: true # Host Client Timeout
esxi_70_000091_Manage: true # The ESXi host must be configured with an appropriate maximum password age.
esxi_70_000097_Manage: true # The ESXi CIM service must be disabled.

# --- SSH checks (off by default — require SSH access to ESXi hosts) ---
esxi_stig_enable_ssh_checks: false
esxi_70_000008_Manage: true   # SSH /etc/issue banner
esxi_70_000009_Manage: true   # SSH Banner directive
esxi_70_000010_Manage: true   # SSH FIPS mode
esxi_70_000012_Manage: true   # SSH IgnoreRhosts
esxi_70_000013_Manage: true   # SSH HostbasedAuthentication
esxi_70_000014_Manage: false  # SSH PermitRootLogin (dangerous — default off)
esxi_70_000015_Manage: true   # SSH PermitEmptyPasswords
esxi_70_000016_Manage: true   # SSH PermitUserEnvironment
esxi_70_000020_Manage: true   # SSH StrictModes
esxi_70_000021_Manage: true   # SSH Compression
esxi_70_000022_Manage: true   # SSH GatewayPorts
esxi_70_000023_Manage: true   # SSH X11Forwarding
esxi_70_000025_Manage: true   # SSH PermitTunnel
esxi_70_000026_Manage: true   # SSH ClientAliveCountMax
esxi_70_000027_Manage: true   # SSH ClientAliveInterval
esxi_70_000082_Manage: true   # SSH AllowTcpForwarding
esxi_70_000274_Manage: true   # SSH FIPS Ciphers

# --- Network / port group rules ---
esxi_70_000048_Manage: true   # Port group forged transmits
esxi_70_000049_Manage: true   # Port group MAC changes
esxi_70_000050_Manage: true   # Port group promiscuous mode
esxi_70_000057_Manage: false  # Firewall default deny (can break connectivity — default off)
esxi_70_000063_Manage: true   # VLAN 4095 not used
esxi_70_000064_Manage: true   # Reserved VLANs not used
esxi_70_000065_Manage: true   # Native VLAN check

# --- Firmware / audit-only rules ---
esxi_70_000072_Manage: true   # Patches current (HIGH)
esxi_70_000076_Manage: true   # Secure Boot
esxi_70_000078_Manage: true   # LDAP TLS
esxi_70_000084_Manage: true   # Audit record storage validation
esxi_70_000085_Manage: true   # Syslog x509 strict
esxi_70_000090_Manage: true   # rhttpproxy FIPS
esxi_70_000092_Manage: true   # VM config override cleared
esxi_70_000093_Manage: true   # VM logger override cleared
esxi_70_000094_Manage: true   # TPM encryption
esxi_70_000095_Manage: true   # execInstalledOnly

# --- Remaining audit-only rules ---
esxi_70_000038_Manage: true   # Host profiles (audit-only)
esxi_70_000070_Manage: true   # CIM access (audit-only)

# =============================================================================
# 2. ESXi STIG REMEDIATION VALUES
# =============================================================================
# These values are applied when vmware_stig_enable_hardening is true, and
# compared against current state when running in audit (check_mode).

esxi_stig_dcui_access: "root"
esxi_stig_syslog_host: ""                          # REQUIRED: e.g. "udp://loghost.example.com:514"
esxi_stig_account_lock_failures: 3
esxi_stig_account_unlock_time: 900
esxi_stig_welcome_message: ""                       # REQUIRED: DoD banner text
esxi_stig_log_level: "info"
esxi_stig_password_quality: "retry=3 min=disabled,disabled,disabled,disabled,15"
esxi_stig_password_history: 5
esxi_stig_mob_enabled: "false"
esxi_stig_ad_admin_group: ""                        # REQUIRED: e.g. "SG-ESXAdmins"
esxi_stig_shell_interactive_timeout: 120
esxi_stig_shell_timeout: 600
esxi_stig_dcui_timeout: 120
esxi_stig_log_dir: ""                               # REQUIRED: e.g. "[datastore1] /logs"
esxi_stig_share_force_salting: 2
esxi_stig_block_guest_bpdu: 1
esxi_stig_dvfilter_bind_ip: ""
esxi_stig_disabled_protocols: "tlsv1,tlsv1.1,sslv3"
esxi_stig_suppress_shell_warning: 0
esxi_stig_suppress_ht_warning: 0
esxi_stig_syslog_check_ssl_certs: "true"
esxi_stig_mem_eager_zero: 1
esxi_stig_api_session_timeout: 30
esxi_stig_host_client_timeout: 600
esxi_stig_password_max_days: 90

# NTP
esxi_stig_ntp_servers: []                           # REQUIRED: e.g. ["0.ntp.mil", "1.ntp.mil"]

# VIB acceptance level
esxi_stig_acceptance_level: "PartnerSupported"

# Lockdown level (for PowerShell remediation)
esxi_stig_lockdown_level: "lockdownNormal"

# SSH sshd_config remediation values
esxi_stig_ssh_banner_file: "/etc/issue"
esxi_stig_ssh_ignore_rhosts: "yes"
esxi_stig_ssh_hostbased_auth: "no"
esxi_stig_ssh_permit_root_login: "no"
esxi_stig_ssh_permit_empty_passwords: "no"
esxi_stig_ssh_permit_user_environment: "no"
esxi_stig_ssh_strict_modes: "yes"
esxi_stig_ssh_compression: "no"
esxi_stig_ssh_gateway_ports: "no"
esxi_stig_ssh_x11_forwarding: "no"
esxi_stig_ssh_permit_tunnel: "no"
esxi_stig_ssh_client_alive_count_max: 3
esxi_stig_ssh_client_alive_interval: 200
esxi_stig_ssh_allow_tcp_forwarding: "no"

# Expected ESXi build number for patch compliance (ESXI-70-000072)
esxi_stig_expected_build: ""                    # e.g. "20036589"

# =============================================================================
# 3. VM STIG TOGGLE FLAGS & VALUES
# =============================================================================
# Per-rule toggle (set to false to skip) and default value.
# Tasks in vm_v7r4.yaml reference these directly.

# Advanced settings toggles
vmch_70_000001_Manage: true   # Copy operations must be disabled
vmch_70_000002_Manage: true   # Drag and drop operations must be disabled
vmch_70_000003_Manage: true   # Paste operations must be disabled
vmch_70_000004_Manage: true   # Virtual disk shrinking must be disabled
vmch_70_000005_Manage: true   # Virtual disk wiping must be disabled
vmch_70_000006_Manage: true   # Virtual disks must be set to persistent mode
vmch_70_000007_Manage: true   # HGFS file transfers must be disabled
vmch_70_000008_Manage: true   # Floppy drives must be disconnected
vmch_70_000009_Manage: true   # CD-ROM drives must not use host device backing
vmch_70_000010_Manage: true   # Parallel ports must not be present
vmch_70_000011_Manage: true   # Serial ports must not be present
vmch_70_000012_Manage: true   # USB controllers must not be present
vmch_70_000013_Manage: true   # Console connection sharing must be limited
vmch_70_000015_Manage: true   # Informational messages to VMX file must be limited
vmch_70_000016_Manage: true   # Unauthorized connection of devices must be prevented
vmch_70_000017_Manage: true   # Guest info gathering must be disabled
vmch_70_000018_Manage: true   # Shared salt values must be disabled
vmch_70_000022_Manage: true   # Guest OS must lock when console closes
vmch_70_000023_Manage: true   # 3D features must be disabled
vmch_70_000024_Manage: true   # vMotion must use encryption
vmch_70_000025_Manage: true   # Guest logging must be enabled
vmch_70_000026_Manage: true   # Log rotation size must be configured
vmch_70_000027_Manage: true   # Log retention must be configured
vmch_70_000029_Manage: true   # FT must use encryption

# Advanced settings default values (keyed by V-number)
vm_stig_256450_value: "TRUE"      # VMCH-70-000001 isolation.tools.copy.disable
vm_stig_256451_value: "TRUE"      # VMCH-70-000002 isolation.tools.dnd.disable
vm_stig_256452_value: "TRUE"      # VMCH-70-000003 isolation.tools.paste.disable
vm_stig_256453_value: "TRUE"      # VMCH-70-000004 isolation.tools.diskShrink.disable
vm_stig_256454_value: "TRUE"      # VMCH-70-000005 isolation.tools.diskWiper.disable
vm_stig_256456_value: "TRUE"      # VMCH-70-000007 isolation.tools.hgfsServerSet.disable
vm_stig_256462_value: "1"         # VMCH-70-000013 RemoteDisplay.maxConnections
vm_stig_256463_value: "1048576"   # VMCH-70-000015 tools.setinfo.sizeLimit
vm_stig_256464_value: "TRUE"      # VMCH-70-000016 isolation.device.connectable.disable
vm_stig_256465_value: "FALSE"     # VMCH-70-000017 tools.guestlib.enableHostInfo
vm_stig_256470_value: "TRUE"      # VMCH-70-000022 tools.guest.desktop.autolock
vm_stig_256471_value: "FALSE"     # VMCH-70-000023 mks.enable3d
vm_stig_256474_value: "2048000"   # VMCH-70-000026 vmx.log.rotateSize
vm_stig_256475_value: "10"        # VMCH-70-000027 vmx.log.keepOld

# Hardware and attribute reference data (for reporting)
vm_stig_hardware_ids:
  floppy:
    {
      id: "VMCH-70-000008",
      severity: "medium",
      title: "Floppy drives must be disconnected",
    }
  cdrom:
    {
      id: "VMCH-70-000009",
      severity: "medium",
      title: "CD-ROM drives must not use host device backing",
    }
  parallel:
    {
      id: "VMCH-70-000010",
      severity: "medium",
      title: "Parallel ports must not be present",
    }
  serial:
    {
      id: "VMCH-70-000011",
      severity: "medium",
      title: "Serial ports must not be present",
    }
  usb:
    {
      id: "VMCH-70-000012",
      severity: "medium",
      title: "USB controllers must not be present",
    }
  persistence:
    {
      id: "VMCH-70-000006",
      severity: "high",
      title: "Virtual disks must be set to persistent mode",
    }

vm_stig_attributes:
  vmotion_encryption:
    {
      id: "VMCH-70-000024",
      severity: "medium",
      title: "vMotion must use encryption",
      required: "opportunistic",
    }
  logging:
    {
      id: "VMCH-70-000025",
      severity: "medium",
      title: "Guest logging must be enabled",
      required: true,
    }
  ft_encryption:
    {
      id: "VMCH-70-000029",
      severity: "medium",
      title: "FT must use encryption",
      required: ["ftEncryptionOpportunistic", "ftEncryptionRequired"],
    }
