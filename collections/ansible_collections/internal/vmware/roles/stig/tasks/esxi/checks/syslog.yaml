---
# collections/ansible_collections/internal/vmware/roles/stig/tasks/esxi/checks/syslog.yaml
# Audit ESXi Syslog
- name: Run Syslog STIG Audit
  ansible.builtin.include_role:
    name: internal.core.stig
    tasks_from: audit_orchestrator
  vars:
    raw_discovery_data: "{{ esxi_ctx.stig_facts | default([]) }}"
    report_prefix: "esxi_syslog_stig"
    audit_logic_inline: |
      {%- set adv = item.get('config', {}).get('option_value', []) -%}
      {{- [
        {
          "id": "ESXI-70-000004",
          "check": (adv | internal.core.get_adv('Syslog.global.logHost') | trim | length > 0),
          "pass_msg": "Remote log host configured",
          "fail_msg": "No remote log host defined"
        },
        {
          "id": "ESXI-70-000086",
          "check": (adv | internal.core.get_adv('Syslog.global.logCheckSSLCerts') | string | lower == 'true'),
          "pass_msg": "Syslog SSL Cert Check Enabled",
          "fail_msg": "Syslog SSL Cert Check Disabled"
        }
      ] | internal.core.stig_eval | to_json -}}
