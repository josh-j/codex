---
# internal.vmware.stig : esxi/discovery.yaml
#
# Refactored discovery orchestrator for ESXi STIG.
# Supports hybrid collection (API modules + legacy script).

- name: "ESXi Discovery | Identity Facts"
  ansible.builtin.include_tasks: identity.yaml
  when: vmware_stig_collector_backend | default('legacy') in ['hybrid', 'external_first']

- name: "ESXi Discovery | API Facts (Legacy/Hybrid)"
  ansible.builtin.include_tasks: base_api.yaml
  when: vmware_stig_collector_backend | default('legacy') in ['legacy', 'hybrid']

- name: "ESXi Discovery | Service Facts"
  ansible.builtin.include_tasks: services.yaml
  when: vmware_stig_collector_backend | default('legacy') in ['hybrid', 'external_first']

- name: "ESXi Discovery | SSH Facts"
  ansible.builtin.include_tasks: ssh_facts.yaml
  tags: [ssh]

- name: "ESXi Discovery | Normalize & Sync"
  ansible.builtin.include_tasks: normalize.yaml
