---
# internal.vmware.stig : vm/collectors/vm_security.yaml

- name: Extract VM security facts
  tags: [discovery, security]
  ansible.builtin.set_fact:
    _vm_security_facts: >-
      {% set vms = {} %}
      {% for vm in _vm_raw_payload | default([]) %}
        {% set _ = vms.update({
          vm.name: {
            'encryption': vm.encryption | default('None'),
            'vmotion_encryption': vm.vmotion_encryption | default('disabled'),
            'logging_enabled': vm.logging_enabled | default(true),
            'ft_encryption': vm.ft_encryption | default('ftEncryptionDisabled')
          }
        }) %}
      {% endfor %}
      {{ vms }}
  when: _vm_raw_payload is defined
