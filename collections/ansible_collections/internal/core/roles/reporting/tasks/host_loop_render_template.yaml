---
# Render a per-host template over an aggregated hosts mapping.
# Required vars:
#   ncs_reporting_hosts_map
#   ncs_reporting_template_src
#   ncs_reporting_template_dest
#
# Optional vars:
#   ncs_reporting_template_mode (default: 0644)
#   ncs_reporting_skip_keys (default common state/meta keys)
#   ncs_reporting_item_vars (dict of additional vars; may reference `item`)

- name: Render per-host template
  ansible.builtin.template:
    src: "{{ ncs_reporting_template_src }}"
    dest: "{{ ncs_reporting_template_dest }}"
    mode: "{{ ncs_reporting_template_mode | default('0644') }}"
  loop: "{{ (ncs_reporting_hosts_map | default({})) | dict2items }}"
  when: item.key not in (ncs_reporting_skip_keys | default('' | internal.core.report_skip_keys))


