# Installed Applications Report

**Hostname:** {{ inventory_hostname }}
**Date:** {{ ansible_date_time.date }} {{ ansible_date_time.time }}
**ConfigMgr Apps Available:** {{ cm_apps | length }}
**Total Installed Apps:** {{ installed_apps_list | length }}

---

## Software Center Applications

| Application Name | Installed Version | Available Version | Publisher | Status |
|------------------|-------------------|-------------------|-----------|--------|
{% for cm_app in cm_apps %}
{% set installed_app = None %}
{% set cm_app_keywords = cm_app.Name | lower | regex_replace('[^a-z0-9 ]', '') | split(' ') | reject('in', ['server', 'client', 'the', 'and', 'or']) | list %}
{% for app in installed_apps_list %}
{% set app_keywords = app.DisplayName | lower | regex_replace('[^a-z0-9 ]', '') | split(' ') %}
{% set match_count = 0 %}
{% for keyword in cm_app_keywords %}
{% if keyword | length > 3 and keyword in app_keywords %}
{% set match_count = match_count + 1 %}
{% endif %}
{% endfor %}
{% if match_count >= 2 or (match_count >= 1 and cm_app_keywords | length <= 2) %}
{% set installed_app = app %}
{% endif %}
{% endfor %}
{% set installed_version = installed_app.DisplayVersion if installed_app else "Not Installed" %}
{% set available_version = cm_app.Version if cm_app.Version else "N/A" %}
{% set status = "✓ Installed" if cm_app.InstallState == "Installed" else "⚠ Available" %}
| {{ cm_app.Name }} | {{ installed_version }} | {{ available_version }} | {{ cm_app.Publisher }} | {{ status }} |
{% endfor %}

---

## All Installed Applications

| Application Name | Version | Publisher | Install Date |
|------------------|---------|-----------|--------------|
{% for app in installed_apps_list | sort(attribute='DisplayName') %}
| {{ app.DisplayName }} | {{ app.DisplayVersion | default('N/A') }} | {{ app.Publisher | default('N/A') }} | {{ app.InstallDate | default('N/A') }} |
{% endfor %}

---

## Summary

**ConfigMgr Apps Installed:** {{ cm_apps | selectattr('InstallState', 'equalto', 'Installed') | list | length }}
**ConfigMgr Apps Available (Not Installed):** {{ cm_apps | rejectattr('InstallState', 'equalto', 'Installed') | list | length }}

### Available for Installation

| Application Name | Version | Publisher |
|------------------|---------|-----------|
{% for cm_app in cm_apps %}
{% if cm_app.InstallState != "Installed" %}
| {{ cm_app.Name }} | {{ cm_app.Version | default('N/A') }} | {{ cm_app.Publisher }} |
{% endif %}
{% endfor %}

---

*Report generated by Ansible winsrv/checks*
