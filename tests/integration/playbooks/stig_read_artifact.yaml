---
# Integration test wrapper: STIG read_callback_artifact
- name: STIG Read Artifact Integration Test
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
    - name: Read STIG callback artifact
      ansible.builtin.include_role:
        name: internal.core.stig
        tasks_from: read_callback_artifact.yaml
      vars:
        _stig_artifacts_dir: "{{ stig_artifacts_dir }}"
        _stig_artifact_host_hint: "{{ stig_host_hint | default('') }}"
        _stig_is_hardening: "{{ stig_is_hardening | default(false) }}"
        _stig_require_artifact: "{{ stig_require_artifact | default(false) }}"

    - name: Dump captured facts to JSON
      ansible.builtin.copy:
        dest: "{{ _output_path }}"
        mode: "0644"
        content: >-
          {{
            {
              'audit_full_list': (audit_full_list | default([])),
              'artifact_path': (_stig_cb_artifact_path | default(''))
            } | to_json
          }}
